{% extends 'base.html' %}

{% block title %}{{ asteroid.name }} - Detailed Analysis{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Header Section -->
    <div class="glass-effect rounded-xl p-6 mb-6 card-hover">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <img src="{{ asteroid.image_url }}" alt="{{ asteroid.name }}" 
                         class="w-24 h-24 rounded-full object-cover border-2 border-cyan-400 pulse-glow">
                    {% if asteroid.is_hazardous %}
                        <div class="hazard-indicator absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs font-bold">⚠</span>
                        </div>
                    {% endif %}
                </div>
                <div>
                    <h1 class="text-4xl font-bold text-cyan-400 neon-text">{{ asteroid.name }}</h1>
                    <p class="text-xl text-gray-300">{{ asteroid.type }}</p>
                    <p class="text-sm text-gray-400">ID: {{ asteroid.id }}</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-{{ asteroid.is_hazardous|yesno:'red,green' }}-400">
                    {{ asteroid.is_hazardous|yesno:'POTENTIALLY HAZARDOUS,SAFE' }}
                </div>
                <div class="text-sm text-gray-400">Classification Status</div>
            </div>
        </div>
        
        <p class="text-gray-300 text-lg leading-relaxed">{{ asteroid.description }}</p>
    </div>

    <!-- Quick Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="glass-effect rounded-lg p-4 text-center card-hover">
            <div class="text-2xl font-bold text-cyan-400">{{ asteroid.diameter_min|floatformat:3 }} - {{ asteroid.diameter_max|floatformat:3 }} km</div>
            <div class="text-sm text-gray-400">Diameter Range</div>
        </div>
        <div class="glass-effect rounded-lg p-4 text-center card-hover">
            <div class="text-2xl font-bold text-yellow-400">{{ asteroid.velocity_kms|floatformat:2 }} km/s</div>
            <div class="text-sm text-gray-400">Approach Velocity</div>
        </div>
        <div class="glass-effect rounded-lg p-4 text-center card-hover">
            <div class="text-2xl font-bold text-green-400">{{ asteroid.miss_distance_km|floatformat:0 }} km</div>
            <div class="text-sm text-gray-400">Miss Distance</div>
        </div>
        <div class="glass-effect rounded-lg p-4 text-center card-hover">
            <div class="text-2xl font-bold text-purple-400">{{ asteroid.close_approach_date }}</div>
            <div class="text-sm text-gray-400">Closest Approach</div>
        </div>
    </div>

    <!-- Main Analysis Sections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Impact Analysis -->
        <div class="glass-effect rounded-xl p-6 card-hover">
            <h2 class="text-2xl font-bold text-red-400 neon-text mb-4 flex items-center">
                <span class="text-3xl mr-2">💥</span>
                Impact Analysis
            </h2>
            
            <div class="space-y-4">
                <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                    <h3 class="text-lg font-semibold text-red-300 mb-2">Impact Probability</h3>
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl font-bold text-red-400">{{ impact_analysis.impact_probability|floatformat:4 }}%</div>
                        <div class="flex-1">
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 to-red-500 h-3 rounded-full" 
                                     style="width: {{ impact_analysis.impact_probability|floatformat:2 }}%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-orange-900/20 rounded-lg p-3 border border-orange-500/30">
                        <div class="text-sm text-orange-300">Mass</div>
                        <div class="text-lg font-bold text-orange-400">{{ impact_analysis.mass_kg|floatformat:0 }} kg</div>
                    </div>
                    <div class="bg-yellow-900/20 rounded-lg p-3 border border-yellow-500/30">
                        <div class="text-sm text-yellow-300">TNT Equivalent</div>
                        <div class="text-lg font-bold text-yellow-400">{{ impact_analysis.tnt_equivalent_tons|floatformat:0 }} tons</div>
                    </div>
                </div>

                <div class="bg-purple-900/20 rounded-lg p-4 border border-purple-500/30">
                    <h4 class="text-md font-semibold text-purple-300 mb-2">Crater Specifications</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>Diameter: <span class="text-purple-400 font-bold">{{ impact_analysis.crater_diameter_m|floatformat:0 }}m</span></div>
                        <div>Depth: <span class="text-purple-400 font-bold">{{ impact_analysis.crater_depth_m|floatformat:0 }}m</span></div>
                    </div>
                </div>

                <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                    <h4 class="text-md font-semibold text-red-300 mb-2">Damage Zones</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Fireball Radius:</span>
                            <span class="text-red-400 font-bold">{{ impact_analysis.fireball_radius_km|floatformat:1 }} km</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Thermal Radiation:</span>
                            <span class="text-orange-400 font-bold">{{ impact_analysis.thermal_radius_km|floatformat:1 }} km</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Overpressure Zone:</span>
                            <span class="text-yellow-400 font-bold">{{ impact_analysis.overpressure_radius_km|floatformat:1 }} km</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Earthquake Magnitude:</span>
                            <span class="text-purple-400 font-bold">{{ impact_analysis.richter_equivalent|floatformat:1 }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trajectory & Orbital Data -->
        <div class="glass-effect rounded-xl p-6 card-hover">
            <h2 class="text-2xl font-bold text-blue-400 neon-text mb-4 flex items-center">
                <span class="text-3xl mr-2">🛸</span>
                Trajectory Analysis
            </h2>
            
            <div class="space-y-4">
                <div class="bg-blue-900/20 rounded-lg p-4 border border-blue-500/30">
                    <h3 class="text-lg font-semibold text-blue-300 mb-3">Orbital Elements</h3>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex justify-between">
                            <span>Semi-major Axis:</span>
                            <span class="text-blue-400 font-bold">{{ trajectory_data.semi_major_axis_au|floatformat:2 }} AU</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Eccentricity:</span>
                            <span class="text-blue-400 font-bold">{{ trajectory_data.eccentricity|floatformat:3 }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Inclination:</span>
                            <span class="text-blue-400 font-bold">{{ trajectory_data.inclination_deg|floatformat:1 }}°</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Orbital Period:</span>
                            <span class="text-blue-400 font-bold">{{ trajectory_data.orbital_period_years|floatformat:1 }} years</span>
                        </div>
                    </div>
                </div>

                <div class="bg-cyan-900/20 rounded-lg p-4 border border-cyan-500/30">
                    <h3 class="text-lg font-semibold text-cyan-300 mb-3">Approach Details</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Approach Angle:</span>
                            <span class="text-cyan-400 font-bold">{{ trajectory_data.approach_angle_deg|floatformat:1 }}°</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Approach Velocity:</span>
                            <span class="text-cyan-400 font-bold">{{ trajectory_data.approach_velocity_kms|floatformat:2 }} km/s</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Closest Approach:</span>
                            <span class="text-cyan-400 font-bold">{{ trajectory_data.closest_approach_date }}</span>
                        </div>
                    </div>
                </div>

                <div class="bg-green-900/20 rounded-lg p-4 border border-green-500/30">
                    <h3 class="text-lg font-semibold text-green-300 mb-3">Distance Extremes</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Perihelion (closest to Sun):</span>
                            <span class="text-green-400 font-bold">{{ trajectory_data.perihelion_distance_au|floatformat:2 }} AU</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Aphelion (farthest from Sun):</span>
                            <span class="text-green-400 font-bold">{{ trajectory_data.aphelion_distance_au|floatformat:2 }} AU</span>
                        </div>
                    </div>
                </div>

                <!-- Advanced Trajectory Visualization -->
                <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-500/30">
                    <h4 class="text-md font-semibold text-gray-300 mb-2">3D Trajectory Visualization</h4>
                    <div class="relative h-64 bg-black/50 rounded-lg overflow-hidden">
                        <!-- Solar System Background -->
                        <div class="absolute inset-0">
                            <!-- Sun -->
                            <div class="absolute top-1/2 left-1/2 w-6 h-6 bg-yellow-400 rounded-full pulse-glow transform -translate-x-1/2 -translate-y-1/2" title="Sun">
                                <div class="absolute inset-0 bg-yellow-400 rounded-full animate-ping opacity-20"></div>
                            </div>
                            
                            <!-- Earth Orbit -->
                            <div class="absolute top-1/2 left-1/2 w-32 h-32 border border-blue-400/30 rounded-full transform -translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute top-1/2 left-3/4 w-3 h-3 bg-blue-400 rounded-full" title="Earth">
                                <div class="absolute inset-0 bg-blue-400 rounded-full animate-pulse opacity-60"></div>
                            </div>
                            
                            <!-- Mars Orbit -->
                            <div class="absolute top-1/2 left-1/2 w-48 h-48 border border-red-400/20 rounded-full transform -translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute top-1/4 right-1/4 w-2 h-2 bg-red-400 rounded-full" title="Mars"></div>
                            
                            <!-- Asteroid Belt -->
                            <div class="absolute top-1/2 left-1/2 w-56 h-56 border border-gray-400/10 rounded-full transform -translate-x-1/2 -translate-y-1/2 border-dashed"></div>
                        </div>
                        
                        <!-- Asteroid Trajectory -->
                        <svg class="absolute inset-0 w-full h-full">
                            <!-- Elliptical Orbit -->
                            <ellipse cx="50%" cy="50%" rx="35%" ry="20%" fill="none" stroke="rgba(0, 255, 255, 0.4)" stroke-width="2" stroke-dasharray="4,4">
                                <animate attributeName="stroke-dashoffset" values="0;8" dur="2s" repeatCount="indefinite"/>
                            </ellipse>
                            
                            <!-- Approach Path -->
                            <path d="M 15% 30% Q 50% 45% 75% 52%" fill="none" stroke="rgba(255, 100, 100, 0.6)" stroke-width="3">
                                <animate attributeName="stroke-dasharray" values="0,100;20,80;0,100" dur="3s" repeatCount="indefinite"/>
                            </path>
                            
                            <!-- Close Approach Point -->
                            <circle cx="75%" cy="52%" r="3" fill="#ff4444">
                                <animate attributeName="r" values="3;6;3" dur="1s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- Trajectory Labels -->
                            <text x="15%" y="25%" fill="#00ffff" font-size="10" font-family="monospace">Start</text>
                            <text x="75%" y="48%" fill="#ff4444" font-size="10" font-family="monospace">Closest Approach</text>
                        </svg>
                        
                        <!-- Asteroid Position -->
                        <div class="absolute top-1/3 left-1/4 w-2 h-2 bg-cyan-400 rounded-full animate-pulse" title="{{ asteroid.name }}">
                            <div class="absolute inset-0 bg-cyan-400 rounded-full animate-ping opacity-40"></div>
                        </div>
                    </div>
                    
                    <!-- Trajectory Data -->
                    <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
                        <div class="text-cyan-400">Current Position: <span class="text-white">{{ trajectory_data.approach_angle_deg|floatformat:1 }}° from Earth</span></div>
                        <div class="text-cyan-400">Approach Speed: <span class="text-white">{{ trajectory_data.approach_velocity_kms|floatformat:2 }} km/s</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Environmental Impact Assessment -->
    <div class="glass-effect rounded-xl p-6 mt-6 card-hover">
        <h2 class="text-2xl font-bold text-green-400 neon-text mb-4 flex items-center">
            <span class="text-3xl mr-2">🌍</span>
            Environmental Impact Assessment
        </h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Impact Scenario -->
            {% if environmental_impact.severity_level == 'global' %}
            <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                <h3 class="text-lg font-semibold text-red-300 mb-2">Impact Scenario</h3>
                <div class="text-2xl font-bold text-red-400 mb-2">
                    {{ environmental_impact.severity_level|upper }}
                </div>
                <p class="text-sm text-gray-300">{{ environmental_impact.description }}</p>
            </div>
            {% else %}
            <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/30">
                <h3 class="text-lg font-semibold text-orange-300 mb-2">Impact Scenario</h3>
                <div class="text-2xl font-bold text-orange-400 mb-2">
                    {{ environmental_impact.severity_level|upper }}
                </div>
                <p class="text-sm text-gray-300">{{ environmental_impact.description }}</p>
            </div>
            {% endif %}

            <!-- Climate Effects -->
            <div class="bg-blue-900/20 rounded-lg p-4 border border-blue-500/30">
                <h3 class="text-lg font-semibold text-blue-300 mb-3">Climate Effects</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>Dust Injection:</span>
                        <span class="text-blue-400 font-bold">{{ environmental_impact.dust_injection_million_tons|floatformat:0 }}M tons</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Temperature Drop:</span>
                        <span class="text-blue-400 font-bold">{{ environmental_impact.temperature_drop_celsius|floatformat:1 }}°C</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Recovery Time:</span>
                        <span class="text-blue-400 font-bold">{{ environmental_impact.recovery_time_years|floatformat:0 }} years</span>
                    </div>
                </div>
            </div>

            <!-- Tsunami Risk -->
            <div class="bg-cyan-900/20 rounded-lg p-4 border border-cyan-500/30">
                <h3 class="text-lg font-semibold text-cyan-300 mb-3">Tsunami Risk (Ocean Impact)</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>Risk Level:</span>
                        <span class="{% if environmental_impact.tsunami_risk == 'high' %}text-red-400{% else %}text-yellow-400{% endif %} font-bold uppercase">{{ environmental_impact.tsunami_risk }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Wave Height:</span>
                        <span class="text-cyan-400 font-bold">{{ environmental_impact.tsunami_height_m|floatformat:0 }}m</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Affected Area:</span>
                        <span class="text-cyan-400 font-bold">{{ environmental_impact.affected_area_km2|floatformat:0 }} km²</span>
                    </div>
                </div>
            </div>
        </div>

            <!-- Geographical Impact Analysis -->
        <div class="mt-6 glass-effect rounded-xl p-6">
            <h3 class="text-2xl font-bold text-purple-400 neon-text mb-4 flex items-center">
                <span class="text-3xl mr-2">🗺️</span>
                Geographical Impact Analysis
            </h3>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Impact Zone Visualization -->
                <div class="bg-gray-900/50 rounded-lg p-4 border border-purple-500/30">
                    <h4 class="text-lg font-semibold text-purple-300 mb-3">Impact Zone Mapping</h4>
                    <div class="relative h-48 bg-black/50 rounded-lg overflow-hidden">
                        <!-- Earth Representation -->
                        <div class="absolute inset-0 bg-gradient-to-br from-blue-900/30 to-green-900/30 rounded-lg">
                            <!-- Continents (simplified) -->
                            <div class="absolute top-1/4 left-1/4 w-16 h-12 bg-green-600/40 rounded-lg" title="North America"></div>
                            <div class="absolute top-1/3 right-1/4 w-12 h-16 bg-green-600/40 rounded-lg" title="Europe/Africa"></div>
                            <div class="absolute bottom-1/3 right-1/3 w-14 h-10 bg-green-600/40 rounded-lg" title="Asia"></div>
                            
                            <!-- Impact Zones -->
                            <div class="absolute top-1/2 left-1/2 w-8 h-8 bg-red-500/60 rounded-full transform -translate-x-1/2 -translate-y-1/2 animate-pulse" title="Ground Zero">
                                <div class="absolute inset-0 bg-red-500 rounded-full animate-ping opacity-30"></div>
                            </div>
                            
                            <!-- Damage Radius Circles -->
                            <div class="absolute top-1/2 left-1/2 w-16 h-16 border-2 border-orange-400/50 rounded-full transform -translate-x-1/2 -translate-y-1/2" title="Severe Damage"></div>
                            <div class="absolute top-1/2 left-1/2 w-24 h-24 border border-yellow-400/30 rounded-full transform -translate-x-1/2 -translate-y-1/2" title="Moderate Damage"></div>
                            <div class="absolute top-1/2 left-1/2 w-32 h-32 border border-green-400/20 rounded-full transform -translate-x-1/2 -translate-y-1/2" title="Light Damage"></div>
                        </div>
                        
                        <!-- Impact Statistics Overlay -->
                        <div class="absolute bottom-2 left-2 text-xs space-y-1">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                <span class="text-red-400">Ground Zero: {{ impact_analysis.fireball_radius_km|floatformat:1 }} km</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-orange-400 rounded-full"></div>
                                <span class="text-orange-400">Severe: {{ impact_analysis.thermal_radius_km|floatformat:1 }} km</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                                <span class="text-yellow-400">Moderate: {{ impact_analysis.overpressure_radius_km|floatformat:1 }} km</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Impact Location & Timing -->
                <div class="space-y-4">
                    <div class="bg-blue-900/20 rounded-lg p-4 border border-blue-500/30">
                        <h4 class="text-lg font-semibold text-blue-300 mb-3">Collision Probability & Timing</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-blue-300">Impact Probability:</span>
                                <span class="text-2xl font-bold text-red-400">{{ impact_analysis.impact_probability|floatformat:6 }}%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 via-yellow-500 to-red-500 h-3 rounded-full" 
                                     style="width: {{ impact_analysis.impact_probability|floatformat:2 }}%"></div>
                            </div>
                            <div class="text-sm space-y-1">
                                <div>Next Close Approach: <span class="text-cyan-400 font-bold">{{ asteroid.close_approach_date }}</span></div>
                                <div>Miss Distance: <span class="text-green-400 font-bold">{{ asteroid.miss_distance_km|floatformat:0 }} km</span></div>
                                <div>Approach Velocity: <span class="text-yellow-400 font-bold">{{ asteroid.velocity_kms|floatformat:2 }} km/s</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-900/20 rounded-lg p-4 border border-purple-500/30">
                        <h4 class="text-lg font-semibold text-purple-300 mb-3">Potential Impact Locations</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Ocean Impact (71% probability):</span>
                                <span class="text-blue-400 font-bold">Tsunami Risk</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Land Impact (29% probability):</span>
                                <span class="text-red-400 font-bold">Direct Devastation</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Populated Area Risk:</span>
                                <span class="text-orange-400 font-bold">{{ environmental_impact.severity_level|title }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Casualty and Economic Impact -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
            <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                <h3 class="text-lg font-semibold text-red-300 mb-2">Estimated Casualties</h3>
                <div class="text-3xl font-bold text-red-400">{{ environmental_impact.casualties_estimate|floatformat:0 }}</div>
                <div class="text-sm text-gray-400">Potential fatalities (worst case scenario)</div>
            </div>
            <div class="bg-yellow-900/20 rounded-lg p-4 border border-yellow-500/30">
                <h3 class="text-lg font-semibold text-yellow-300 mb-2">Economic Damage</h3>
                <div class="text-3xl font-bold text-yellow-400">${{ environmental_impact.economic_damage_billion_usd|floatformat:0 }}B</div>
                <div class="text-sm text-gray-400">Estimated economic losses (USD)</div>
            </div>
            <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/30">
                <h3 class="text-lg font-semibold text-orange-300 mb-2">Seismic Impact</h3>
                <div class="text-3xl font-bold text-orange-400">{{ impact_analysis.richter_equivalent|floatformat:1 }}</div>
                <div class="text-sm text-gray-400">Richter Scale Equivalent</div>
            </div>
        </div>
    </div>

    <!-- Timeline Analysis -->
    <div class="glass-effect rounded-xl p-6 mt-6">
        <h3 class="text-2xl font-bold text-cyan-400 neon-text mb-4 flex items-center">
            <span class="text-3xl mr-2">⏰</span>
            Impact Timeline & Monitoring
        </h3>
        
        <div class="relative">
            <!-- Timeline Line -->
            <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-gradient-to-b from-cyan-400 to-red-400"></div>
            
            <!-- Timeline Events -->
            <div class="space-y-6">
                <div class="flex items-center space-x-4">
                    <div class="w-4 h-4 bg-green-400 rounded-full border-2 border-white"></div>
                    <div class="flex-1">
                        <div class="text-green-400 font-semibold">Current Status - Monitoring Phase</div>
                        <div class="text-sm text-gray-300">Continuous orbital tracking and refinement of trajectory calculations</div>
                        <div class="text-xs text-gray-400">Distance: {{ asteroid.miss_distance_km|floatformat:0 }} km from Earth</div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="w-4 h-4 bg-yellow-400 rounded-full border-2 border-white"></div>
                    <div class="flex-1">
                        <div class="text-yellow-400 font-semibold">{{ asteroid.close_approach_date }} - Closest Approach</div>
                        <div class="text-sm text-gray-300">Asteroid reaches minimum distance from Earth</div>
                        <div class="text-xs text-gray-400">Velocity: {{ asteroid.velocity_kms|floatformat:2 }} km/s</div>
                    </div>
                </div>
                
                {% if impact_analysis.impact_probability > 0.01 %}
                <div class="flex items-center space-x-4">
                    <div class="w-4 h-4 bg-red-400 rounded-full border-2 border-white animate-pulse"></div>
                    <div class="flex-1">
                        <div class="text-red-400 font-semibold">Potential Impact Window</div>
                        <div class="text-sm text-gray-300">{{ impact_analysis.impact_probability|floatformat:4 }}% probability of Earth impact</div>
                        <div class="text-xs text-gray-400">Requires immediate monitoring and potential deflection planning</div>
                    </div>
                </div>
                {% endif %}
                
                <div class="flex items-center space-x-4">
                    <div class="w-4 h-4 bg-blue-400 rounded-full border-2 border-white"></div>
                    <div class="flex-1">
                        <div class="text-blue-400 font-semibold">Post-Approach Monitoring</div>
                        <div class="text-sm text-gray-300">Continued tracking for future orbital predictions</div>
                        <div class="text-xs text-gray-400">Next orbital period: {{ trajectory_data.orbital_period_years|floatformat:1 }} years</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="flex justify-center space-x-4 mt-8">
        <a href="{% url 'dashboard:asteroids' %}" 
           class="px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-lg hover:from-blue-500 hover:to-cyan-500 transition-all duration-300 font-semibold">
            ← Back to Asteroids
        </a>
        <a href="{% url 'simulation:simulation' %}" 
           class="px-6 py-3 bg-gradient-to-r from-red-600 to-orange-600 rounded-lg hover:from-red-500 hover:to-orange-500 transition-all duration-300 font-semibold">
            Run Impact Simulation →
        </a>
        <button onclick="generateReport()" 
                class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg hover:from-purple-500 hover:to-pink-500 transition-all duration-300 font-semibold">
            📊 Generate Report
        </button>
    </div>
</div>

<script>
// Auto-refresh data every 10 minutes (reduced frequency for performance)
setTimeout(() => {
    location.reload();
}, 600000);

// Add loading animation for images
document.addEventListener('DOMContentLoaded', function() {
    const img = document.querySelector('img[alt="{{ asteroid.name|escapejs }}"]');
    if (img) {
        img.addEventListener('load', function() {
            this.classList.add('animate-pulse');
            setTimeout(() => this.classList.remove('animate-pulse'), 1000);
        });
    }
    
    // Initialize trajectory animation
    initializeTrajectoryAnimation();
});

function initializeTrajectoryAnimation() {
    // Add dynamic trajectory visualization
    const trajectoryPath = document.querySelector('svg path');
    if (trajectoryPath) {
        trajectoryPath.style.strokeDasharray = '0,1000';
        trajectoryPath.style.animation = 'drawPath 5s ease-in-out infinite';
    }
}

function generateReport() {
    // Generate comprehensive impact report
    const reportData = {
        asteroid: '{{ asteroid.name|escapejs }}',
        diameter: '{{ asteroid.diameter_min|floatformat:3 }} - {{ asteroid.diameter_max|floatformat:3 }} km',
        velocity: '{{ asteroid.velocity_kms|floatformat:2 }} km/s',
        approach_date: '{{ asteroid.close_approach_date|escapejs }}',
        impact_probability: '{{ impact_analysis.impact_probability|floatformat:6 }}%',
        tnt_equivalent: '{{ impact_analysis.tnt_equivalent_tons|floatformat:0 }} tons',
        crater_diameter: '{{ impact_analysis.crater_diameter_m|floatformat:0 }}m',
        casualties: '{{ environmental_impact.casualties_estimate|floatformat:0 }}',
        economic_damage: '${{ environmental_impact.economic_damage_billion_usd|floatformat:0 }}B',
        severity: '{{ environmental_impact.severity_level|escapejs }}'
    };
    
    // Create downloadable report
    const reportContent = `
ASTEROID IMPACT ANALYSIS REPORT
================================

Asteroid: ${reportData.asteroid}
Diameter: ${reportData.diameter}
Approach Velocity: ${reportData.velocity}
Closest Approach: ${reportData.approach_date}

IMPACT ANALYSIS
===============
Impact Probability: ${reportData.impact_probability}
TNT Equivalent: ${reportData.tnt_equivalent}
Crater Diameter: ${reportData.crater_diameter}

ENVIRONMENTAL IMPACT
===================
Severity Level: ${reportData.severity}
Estimated Casualties: ${reportData.casualties}
Economic Damage: ${reportData.economic_damage}

Generated: ${new Date().toLocaleString()}
    `;
    
    const blob = new Blob([reportContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${reportData.asteroid}_Impact_Analysis_Report.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    alert('Impact analysis report generated and downloaded!');
}

// Add CSS for trajectory animation
const style = document.createElement('style');
style.textContent = `
    @keyframes drawPath {
        0% { stroke-dasharray: 0,1000; }
        50% { stroke-dasharray: 500,500; }
        100% { stroke-dasharray: 1000,0; }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}